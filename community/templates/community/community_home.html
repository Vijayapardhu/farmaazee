{% extends 'base.html' %}
{% load static %}

{% block title %}Community - Smart Farmer Support{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 4rem 0;
        margin-bottom: 3rem;
    }
    
    .topic-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 15px;
        overflow: hidden;
        height: 100%;
    }
    
    .topic-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .topic-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
    }
    
    .stat-item {
        text-align: center;
        flex: 1;
    }
    
    .stat-value {
        font-size: 1.1rem;
        font-weight: bold;
        color: #28a745;
    }
    
    .stat-label {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .expert-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        height: 100%;
        transition: transform 0.3s ease;
    }
    
    .expert-card:hover {
        transform: translateY(-5px);
    }
    
    .expert-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0 auto 1rem;
        border: 3px solid #28a745;
    }
    
    .event-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        height: 100%;
        transition: transform 0.3s ease;
    }
    
    .event-card:hover {
        transform: translateY(-5px);
    }
    
    .event-date {
        background: #28a745;
        color: white;
        border-radius: 10px;
        padding: 0.5rem;
        text-align: center;
        margin-bottom: 1rem;
    }
    
    .question-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        height: 100%;
        transition: transform 0.3s ease;
    }
    
    .question-card:hover {
        transform: translateY(-5px);
    }
    
    .question-stats {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .stats-card {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .category-badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-users"></i>
                    Farmer Community
                </h1>
                <p class="lead mb-4">
                    Connect with fellow farmers, share knowledge, ask questions, and learn from agricultural experts. Join our growing community of farming professionals.
                </p>
                <div class="d-flex gap-3">
                    <a href="{% url 'community:forum_list' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-comments"></i> Join Discussion
                    </a>
                    <a href="{% url 'community:qa_list' %}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-question-circle"></i> Ask Questions
                    </a>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <i class="fas fa-handshake fa-5x mb-3"></i>
                <div class="row mt-4">
                    <div class="col-4">
                        <div class="text-center">
                            <h3 class="mb-0">{{ total_members|default:0 }}</h3>
                            <small>Members</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-center">
                            <h3 class="mb-0">{{ total_topics|default:0 }}</h3>
                            <small>Topics</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-center">
                            <h3 class="mb-0">{{ total_questions|default:0 }}</h3>
                            <small>Questions</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Quick Stats -->
    <div class="row mb-5">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <i class="fas fa-comments fa-2x mb-2"></i>
                    <h4 class="card-title">{{ total_topics|default:0 }}</h4>
                    <p class="card-text">Forum Topics</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <i class="fas fa-question-circle fa-2x mb-2"></i>
                    <h4 class="card-title">{{ total_questions|default:0 }}</h4>
                    <p class="card-text">Questions Asked</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center bg-warning text-white">
                <div class="card-body">
                    <i class="fas fa-user-graduate fa-2x mb-2"></i>
                    <h4 class="card-title">{{ total_experts|default:0 }}</h4>
                    <p class="card-text">Experts</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                    <h4 class="card-title">{{ total_events|default:0 }}</h4>
                    <p class="card-text">Events</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Forum Topics -->
    {% if recent_topics %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-comments text-primary"></i>
                    Recent Discussions
                </h2>
                <a href="{% url 'community:forum_list' %}" class="btn btn-outline-primary">
                    View All Topics
                </a>
            </div>
        </div>
        {% for topic in recent_topics %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card topic-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="card-title mb-0">{{ topic.title }}</h6>
                        <span class="badge bg-primary category-badge">{{ topic.category.name }}</span>
                    </div>
                    <p class="card-text text-muted small">{{ topic.content|truncatewords:15 }}</p>
                    
                    <div class="topic-stats">
                        <div class="stat-item">
                            <div class="stat-value">{{ topic.replies.count }}</div>
                            <div class="stat-label">Replies</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ topic.views }}</div>
                            <div class="stat-label">Views</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ topic.created_at|timesince }}</div>
                            <div class="stat-label">Ago</div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-user"></i> {{ topic.author.username }}
                        </small>
                        <a href="{% url 'community:forum_detail' topic.id %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye"></i> View
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Recent Questions -->
    {% if recent_questions %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-question-circle text-success"></i>
                    Recent Questions
                </h2>
                <a href="{% url 'community:qa_list' %}" class="btn btn-outline-success">
                    View All Questions
                </a>
            </div>
        </div>
        {% for question in recent_questions %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="question-card">
                <h6 class="card-title">{{ question.title }}</h6>
                <p class="card-text text-muted small">{{ question.content|truncatewords:20 }}</p>
                
                <div class="question-stats">
                    <span class="badge bg-primary">{{ question.answers.count }} Answers</span>
                    <span class="badge bg-success">{{ question.views }} Views</span>
                    <span class="badge bg-info">{{ question.created_at|timesince }} ago</span>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-user"></i> {{ question.author.username }}
                    </small>
                    <a href="{% url 'community:qa_detail' question.id %}" class="btn btn-outline-success btn-sm float-end">
                        <i class="fas fa-eye"></i> View
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Featured Experts -->
    {% if featured_experts %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-user-graduate text-warning"></i>
                    Featured Experts
                </h2>
                <a href="{% url 'community:expert_list' %}" class="btn btn-outline-warning">
                    View All Experts
                </a>
            </div>
        </div>
        {% for expert in featured_experts %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="expert-card">
                {% if expert.avatar %}
                    <img src="{{ expert.avatar.url }}" class="expert-avatar" alt="{{ expert.name }}">
                {% else %}
                    <div class="expert-avatar bg-primary d-flex align-items-center justify-content-center">
                        <i class="fas fa-user-graduate fa-2x text-white"></i>
                    </div>
                {% endif %}
                <h5 class="card-title">{{ expert.name }}</h5>
                <p class="text-muted small">{{ expert.specialization }}</p>
                <p class="card-text small">{{ expert.bio|truncatewords:15 }}</p>
                <div class="mb-2">
                    <span class="badge bg-success">{{ expert.questions_answered }} Answered</span>
                    <span class="badge bg-info">{{ expert.rating|floatformat:1 }} ★</span>
                </div>
                <a href="{% url 'community:expert_detail' expert.id %}" class="btn btn-outline-primary btn-sm">
                    View Profile
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Upcoming Events -->
    {% if upcoming_events %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-calendar-alt text-info"></i>
                    Upcoming Events
                </h2>
                <a href="{% url 'community:event_list' %}" class="btn btn-outline-info">
                    View All Events
                </a>
            </div>
        </div>
        {% for event in upcoming_events %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="event-card">
                <div class="event-date">
                    <div class="fw-bold">{{ event.start_date|date:"M d" }}</div>
                    <small>{{ event.start_date|date:"Y" }}</small>
                </div>
                <h6 class="card-title">{{ event.title }}</h6>
                <p class="card-text text-muted small">{{ event.description|truncatewords:15 }}</p>
                
                <div class="mb-3">
                    <small class="text-muted">
                        <i class="fas fa-clock"></i> {{ event.start_time|time:"H:i" }} - {{ event.end_time|time:"H:i" }}
                    </small>
                    <br>
                    <small class="text-muted">
                        <i class="fas fa-map-marker-alt"></i> {{ event.location }}
                    </small>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-primary">{{ event.registrations.count }} Registered</span>
                    <a href="{% url 'community:event_detail' event.id %}" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-info-circle"></i> Details
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Call to Action -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="stats-card">
                <div class="row">
                    <div class="col-md-6">
                        <h3>Have a question?</h3>
                        <p class="mb-3">Get answers from agricultural experts and fellow farmers in our community.</p>
                        <a href="{% url 'community:qa_list' %}" class="btn btn-light btn-lg">
                            <i class="fas fa-question-circle"></i> Ask a Question
                        </a>
                    </div>
                    <div class="col-md-6">
                        <h3>Share your knowledge</h3>
                        <p class="mb-3">Start a discussion or share your farming experiences with the community.</p>
                        <a href="{% url 'community:forum_list' %}" class="btn btn-light btn-lg">
                            <i class="fas fa-comments"></i> Start Discussion
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="text-center mb-4">
                <i class="fas fa-link text-primary"></i>
                Community Features
            </h3>
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-3">
                    <a href="{% url 'community:forum_list' %}" class="card text-center text-decoration-none">
                        <div class="card-body">
                            <i class="fas fa-comments fa-2x text-primary mb-2"></i>
                            <h5 class="card-title">Forum</h5>
                            <p class="card-text">Join discussions on farming topics</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <a href="{% url 'community:qa_list' %}" class="card text-center text-decoration-none">
                        <div class="card-body">
                            <i class="fas fa-question-circle fa-2x text-success mb-2"></i>
                            <h5 class="card-title">Q&A</h5>
                            <p class="card-text">Ask questions and get expert answers</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <a href="{% url 'community:expert_list' %}" class="card text-center text-decoration-none">
                        <div class="card-body">
                            <i class="fas fa-user-graduate fa-2x text-warning mb-2"></i>
                            <h5 class="card-title">Experts</h5>
                            <p class="card-text">Connect with agricultural experts</p>
                        </div>
                    </a>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <a href="{% url 'community:event_list' %}" class="card text-center text-decoration-none">
                        <div class="card-body">
                            <i class="fas fa-calendar-alt fa-2x text-info mb-2"></i>
                            <h5 class="card-title">Events</h5>
                            <p class="card-text">Attend farming workshops and events</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add loading animation to cards
document.querySelectorAll('.topic-card, .question-card, .expert-card, .event-card').forEach(card => {
    card.addEventListener('click', function(e) {
        if (!e.target.closest('a')) {
            const link = this.querySelector('a');
            if (link) {
                link.click();
            }
        }
    });
});

// Initialize tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
});

// Auto-refresh community stats every 5 minutes
setInterval(function() {
    // You could add AJAX call here to refresh stats
    console.log('Refreshing community stats...');
}, 5 * 60 * 1000);
</script>
{% endblock %}



